#' Read JACUSA ressult file
#'
#' \code{read_jacusa()} Reads data that was generated by JACUSA.
#'
#' @param file String represents the filename of the JACUSA output.
#' @param ... Additional parameters that will be forwarded to read.table.
#'
#' @export
read_jacusa <- function(file, ...) {
	d <- utils::read.table(file, header = TRUE, stringsAsFactors = FALSE, check.names = FALSE, comment.char = "", ...) 
	colnames(d)[1] <- gsub("^#", "", colnames(d)[1])
	jacusa <- as.list(d)
	jacusa
}

#' Write a JACUSA list object to a file
#'
#' \code{write_jacusa} Stores a list of sites in a file.
#' 
#' @param jacusa List created by \code{read_jacusa()}.
#' @param file String is the filename to store the list.
#' @param extra Vector of strings that define additional elements from the list that 
#'        will be stored in the file. 
#'
#' @export 
write_jacusa <- function(jacusa, file, extra = NULL) {
  bed6 <- names(jacusa)[names(jacusa) %in% c("contig", "start", "end", "name", "stat", "pvalue", "strand")]
  
  data_fields <- c()
  data_type <- 0

  # add bases fields
  i <- grep("^bases", names(jacusa))
  base_fields <- names(jacusa)[i]
  if (length(base_fields > 0)) {
    data_fields <- c(data_fields, base_fields)
    data_type <- data_type + 1
  }
  
  # add read arrest through fields
  i <- grep("^reads", names(jacusa))
  reads_fields <- names(jacusa)[i]
  if (length(reads_fields > 0)) {
    data_fields <- c(base_fields, reads_fields)
    data_type <- data_type + 1
  }

  # rearrange data fields
  if (data_type == 2) {
    tmp <- vector("character", length(data_fields))
    n <- length(data_fields)
    h <-  n / 2
    tmp[seq(1, n, 2)] <- data_fields[1:h]
    tmp[seq(2, n, 2)] <- data_fields[(h+1):n]
    data_fields <- tmp
  }
  
  info <- names(jacusa)[names(jacusa) %in% c("info", "filter_info", "refBase")]
  
  fields <- c(bed6, data_fields, info)
  if (! is.null(extra)) {
    fields <- c(fields, extra)
  }

  jacusa <- jacusa[fields]

  d <- as.data.frame(jacusa, stringsAsFactors = FALSE, check.names = FALSE)
  colnames(d)[1] <- paste0("#", colnames(d)[1])
  utils::write.table(d, file, col.names = TRUE, row.names = FALSE, quote = FALSE, sep = "\t")
}
