#' Read JACUSA ressult file
#'
#' \code{read_jacusa()} Reads data that was generated by JACUSA.
#'
#' @param file String represents the filename of the JACUSA output.
#' @param ... Additional parameters that will be forwarded to read.table.
#'
#' @export
read_jacusa <- function(file, ...) {
	d <- read.table(file, header = TRUE, stringsAsFactors = FALSE, check.names = FALSE, comment.char = "", ...) 
	colnames(d)[1] <- gsub("^#", "", colnames(d)[1])
	jacusa <- as.list(d)
	jacusa
}

#' Write a JACUSA list object to a file
#'
#' \code{write_jacusa} Stores a list of sites in a file.
#' 
#' @param jacusa List created by \code{read_jacusa()}.
#' @param file String is the filename to store the list.
#' @param extra Vector of strings that define additional elements from the list that 
#'        will be stored in the file. 
#'
#' @export 
write_jacusa <- function(jacusa, file, extra = NULL) {
  fields <- c("contig", "start", "end", "name", "stat", "strand", "info", "filter_info", "ref", "pvalue")
  if (! is.null(extra)) {
    fields <- c(fields, extra)
  }
  fields <- names(jacusa)[names(jacusa) %in% fields]

  # add bases fields
  i <- grep("^bases", names(jacusa))
  fields <- c(fields, names(jacusa)[i])
  jacusa <- jacusa[fields]

  # add read_t_e fields
  i <- grep("^read", names(jacusa))
  fields <- c(fields, names(jacusa)[i])
  jacusa <- jacusa[fields]
  
  d <- as.data.frame(jacusa, stringsAsFactors = FALSE, check.names = FALSE)
  colnames(d)[1] <- paste0("#", colnames(d)[1])
  write.table(d, file, col.names = TRUE, row.names = FALSE, quote = FALSE, sep = "\t")
}
